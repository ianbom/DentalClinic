import{r,j as e,d as w,L as A}from"./app-DCvnCINP.js";import{u as T}from"./BookingContext-Dwdd_TsP.js";function J({doctorId:f,isAdmin:K=!1,provinces:C=[]}){const{bookingData:t,setBookingData:l}=T(),[h,b]=r.useState(!1),[g,y]=r.useState(!1),[I,x]=r.useState(""),[n,c]=r.useState(null),[W,$]=r.useState(!1),[S,k]=r.useState([]),[V,m]=r.useState([]),[_,d]=r.useState([]),[q,N]=r.useState(!1),[B,j]=r.useState(!1),[R,v]=r.useState(!1);r.useEffect(()=>{t.provinceId?(N(!0),k([]),m([]),d([]),fetch(`/api/provinces/${t.provinceId}/cities`).then(a=>a.json()).then(a=>{k(a),N(!1)}).catch(a=>{console.error("Error fetching cities:",a),N(!1)})):(k([]),m([]),d([]))},[t.provinceId]),r.useEffect(()=>{t.cityId?(j(!0),m([]),d([]),fetch(`/api/cities/${t.cityId}/districts`).then(a=>a.json()).then(a=>{m(a),j(!1)}).catch(a=>{console.error("Error fetching districts:",a),j(!1)})):(m([]),d([]))},[t.cityId]),r.useEffect(()=>{t.districtId?(v(!0),d([]),fetch(`/api/districts/${t.districtId}/villages`).then(a=>a.json()).then(a=>{d(a),v(!1)}).catch(a=>{console.error("Error fetching villages:",a),v(!1)})):d([])},[t.districtId]),r.useEffect(()=>{if(t.villageName&&t.districtName&&t.cityName&&t.provinceName){const a=`${t.villageName}, ${t.districtName}, ${t.cityName}, ${t.provinceName}`;l({address:a})}},[t.villageName,t.districtName,t.cityName,t.provinceName]);const p=(a,s)=>{const i=a==="fullName"?s.toUpperCase():s;l({[a]:i}),a==="whatsapp"&&x(""),a==="nik"&&(l({isNikChecked:!1}),c(null))},D=a=>{const s=a.target.value,i=C.find(o=>String(o.id)===s);l({provinceId:s,provinceName:i?.name||"",cityId:"",cityName:"",districtId:"",districtName:"",address:""})},E=a=>{const s=a.target.value,i=S.find(o=>String(o.id)===s);l({cityId:s,cityName:i?.name||"",districtId:"",districtName:"",address:""})},L=a=>{const s=a.target.value,i=V.find(o=>String(o.id)===s);l({districtId:s,districtName:i?.name||"",villageId:"",villageName:""})},P=a=>{const s=a.target.value,i=_.find(o=>String(o.id)===s);l({villageId:s,villageName:i?.name||""})},F=()=>{if(!t.nik||t.nik.length<16){c({type:"error",text:"NIK harus 16 digit"});return}y(!0),c(null),w.post("/check-nik",{nik:t.nik},{preserveState:!0,preserveScroll:!0,onSuccess:a=>{const s=a.props.flash;if(s?.nikCheck?.found&&s.nikCheck.patient){const i=!!s.nikCheck.patient.patient_address;l({fullName:s.nikCheck.patient.patient_name?.toUpperCase()||"",whatsapp:s.nikCheck.patient.patient_phone||"",birthdate:s.nikCheck.patient.patient_birthdate||"",address:s.nikCheck.patient.patient_address||"",gender:s.nikCheck.patient.gender||"",isNikChecked:!0,districtId:i?"prefilled":""}),$(i),c({type:"success",text:"Data ditemukan! Form telah terisi otomatis."})}else l({isNikChecked:!0}),c({type:"info",text:"NIK belum terdaftar. Silakan isi data lengkap."});y(!1)},onError:()=>{c({type:"error",text:"Gagal memeriksa NIK. Coba lagi."}),y(!1)}})},M=()=>{if(!t.whatsapp||t.whatsapp.length<10){x("Masukkan nomor WhatsApp yang valid");return}b(!0),x(""),w.post("/verify-wa",{patient_phone:t.whatsapp},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{l({isWhatsappVerified:!0}),b(!1)},onError:()=>{x("Gagal mengirim pesan verifikasi. Coba lagi."),b(!1)}})},u=t.fullName.trim()!==""&&t.nik.trim()!==""&&t.nik.length>=16&&t.whatsapp.trim()!==""&&t.whatsapp.length>=10&&t.birthdate.trim()!==""&&t.gender!==""&&(t.villageId!==""||t.address.trim()!=="")&&t.isWhatsappVerified&&t.isNikChecked;return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 border-b border-subtle-light pb-6",children:[e.jsx("h1",{className:"text-3xl font-bold leading-tight text-text-light",children:"Isi Data Diri"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pastikan nomor WhatsApp aktif untuk verifikasi pesanan dan notifikasi jadwal."})]}),e.jsxs("form",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",htmlFor:"nik",children:"NIK (Nomor Induk Kependudukan)*"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:`flex h-12 flex-1 rounded-lg border bg-white px-4 py-3 text-base text-text-light transition-shadow placeholder:text-gray-400 focus:outline-none focus:ring-1 ${n?.type==="success"?"border-green-300 focus:border-green-400 focus:ring-green-400":n?.type==="error"?"border-red-300 focus:border-red-400 focus:ring-red-400":"border-gray-200 focus:border-primary focus:ring-primary"}`,id:"nik",placeholder:"Masukkan 16 digit NIK Anda",type:"text",maxLength:16,required:!0,value:t.nik,onChange:a=>p("nik",a.target.value.replace(/\D/g,""))}),e.jsxs("button",{type:"button",onClick:F,disabled:g||t.nik.length<16,className:`flex h-12 items-center justify-center gap-2 whitespace-nowrap rounded-lg px-4 text-sm font-medium transition-all ${g||t.nik.length<16?"cursor-not-allowed bg-gray-200 text-gray-400":t.isNikChecked?"cursor-pointer bg-green-100 text-green-700":"cursor-pointer bg-primary text-white hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:g?"hourglass_empty":t.isNikChecked?"check_circle":"search"}),g?"Memeriksa...":t.isNikChecked?"Terverifikasi":"Cek NIK"]})]}),n&&e.jsx("div",{className:`mt-2 rounded-lg border p-3 text-sm ${n.type==="success"?"border-green-200 bg-green-50 text-green-700":n.type==="info"?"border-blue-200 bg-blue-50 text-blue-700":"border-red-200 bg-red-50 text-red-700"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:n.type==="success"?"check_circle":n.type==="info"?"info":"error"}),e.jsx("p",{children:n.text})]})}),!t.isNikChecked&&!n&&e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:'Klik tombol "Cek NIK" untuk memverifikasi dan melihat apakah data Anda sudah terdaftar.'})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",htmlFor:"fullname",children:"Nama Lengkap*"}),e.jsx("input",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base uppercase text-text-light transition-shadow placeholder:normal-case placeholder:text-gray-400 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary",id:"fullname",placeholder:"Masukkan nama lengkap Anda sesuai KTP",type:"text",required:!0,value:t.fullName,onChange:a=>p("fullName",a.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",children:"Jenis Kelamin*"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-3 transition-all hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx("input",{type:"radio",name:"gender",value:"male",checked:t.gender==="male",onChange:a=>p("gender",a.target.value),className:"h-4 w-4 text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-light",children:"Laki-laki"})]}),e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-lg border border-gray-200 bg-white px-4 py-3 transition-all hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/5",children:[e.jsx("input",{type:"radio",name:"gender",value:"female",checked:t.gender==="female",onChange:a=>p("gender",a.target.value),className:"h-4 w-4 text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-light",children:"Perempuan"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",htmlFor:"birthdate",children:"Tanggal Lahir*"}),e.jsx("input",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base text-text-light transition-shadow placeholder:text-gray-400 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary",id:"birthdate",type:"date",required:!0,value:t.birthdate,onChange:a=>p("birthdate",a.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",children:"Alamat*"}),W?e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-100 px-4 py-3",children:[e.jsx("p",{className:"text-base text-text-light",children:t.address}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Alamat dari data pasien terdaftar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("select",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base text-text-light transition-shadow focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary",value:t.provinceId,onChange:D,children:[e.jsx("option",{value:"",children:"Pilih Provinsi"}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("select",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base text-text-light transition-shadow focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary disabled:bg-gray-100 disabled:text-gray-400",value:t.cityId,onChange:E,disabled:!t.provinceId,children:[e.jsx("option",{value:"",children:"Pilih Kota/Kabupaten"}),S.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("select",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base text-text-light transition-shadow focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary disabled:bg-gray-100 disabled:text-gray-400",value:t.districtId,onChange:L,disabled:!t.cityId,children:[e.jsx("option",{value:"",children:"Pilih Kecamatan"}),V.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("select",{className:"flex h-12 w-full rounded-lg border border-gray-200 bg-white px-4 py-3 text-base text-text-light transition-shadow focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary disabled:bg-gray-100 disabled:text-gray-400",value:t.villageId,onChange:P,disabled:!t.districtId,children:[e.jsx("option",{value:"",children:"Pilih Kelurahan/Desa"}),_.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),t.address&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Alamat terpilih:"})," ",t.address]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-light",htmlFor:"whatsapp",children:"Nomor WhatsApp*"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"ðŸ“ž"}),e.jsx("div",{className:"ml-2 h-4 w-px bg-gray-300"})]}),e.jsx("input",{className:`flex h-12 w-full rounded-lg border bg-white py-3 pl-[70px] pr-4 text-base text-text-light transition-shadow placeholder:text-gray-400 focus:outline-none focus:ring-1 ${t.isWhatsappVerified?"border-green-300 focus:border-green-400 focus:ring-green-400":"border-gray-200 focus:border-primary focus:ring-primary"}`,id:"whatsapp",placeholder:"0812-3456-7890",type:"tel",required:!0,value:t.whatsapp,onChange:a=>p("whatsapp",a.target.value)}),t.isWhatsappVerified&&e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4",children:e.jsx("span",{className:"material-symbols-outlined text-green-500",children:"verified"})})]}),!t.isWhatsappVerified&&e.jsxs("button",{type:"button",onClick:M,disabled:h||!t.whatsapp||t.whatsapp.length<10,className:`mt-2 flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${h||!t.whatsapp||t.whatsapp.length<10?"cursor-not-allowed bg-gray-200 text-gray-400":"cursor-pointer bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:h?"hourglass_empty":"send"}),h?"Mengirim...":"Kirim Verifikasi WhatsApp"]}),t.isWhatsappVerified&&e.jsx("div",{className:"mt-2 rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"check_circle"}),e.jsx("p",{children:"Nomor WhatsApp telah terverifikasi. Anda dapat melanjutkan proses booking."})]})}),I&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"error"}),e.jsx("p",{children:I})]})}),!t.isWhatsappVerified&&e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Klik tombol di atas untuk memverifikasi nomor WhatsApp Anda sebelum melanjutkan."})]}),(!t.isWhatsappVerified||!t.isNikChecked)&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4 text-sm text-amber-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"warning"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Verifikasi diperlukan:"}),!t.isNikChecked&&' Klik "Cek NIK" untuk memverifikasi NIK Anda.',!t.isWhatsappVerified&&" Verifikasi nomor WhatsApp sebelum melanjutkan."]})]})}),e.jsx("div",{className:"mt-4 flex flex-col justify-end gap-3 border-t border-subtle-light pt-4 sm:flex-row",children:K?e.jsxs("button",{type:"button",disabled:!u,onClick:()=>{u&&w.post("/admin/bookings/store",{doctor_id:f,patient_name:t.fullName,patient_nik:t.nik,patient_phone:t.whatsapp,patient_birthdate:t.birthdate,patient_address:t.address,gender:t.gender,booking_date:t.rawSelectedDate,start_time:t.selectedTime||null,service:t.service,type:t.serviceType||"sisipan"})},className:`flex w-full items-center justify-center gap-2 rounded-lg px-8 py-3 font-bold transition-all md:w-auto ${u?"cursor-pointer bg-primary text-white hover:bg-primary-dark focus:ring-4 focus:ring-primary/20":"cursor-not-allowed bg-gray-300 text-gray-500"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"save"}),e.jsx("span",{children:"Simpan Booking"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{href:`/doctors/${f}/booking`,className:"flex w-full cursor-pointer items-center justify-center gap-2 rounded-lg border border-gray-300 px-6 py-3 font-semibold text-gray-700 transition-all hover:bg-gray-50 md:w-auto",children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"arrow_back"}),e.jsx("span",{children:"Kembali"})]}),u?e.jsxs(A,{href:`/doctors/${f}/booking/patient-data/review`,className:"flex w-full cursor-pointer items-center justify-center gap-2 rounded-lg bg-primary px-8 py-3 font-bold text-white transition-all hover:bg-primary-dark focus:ring-4 focus:ring-primary/20 md:w-auto",children:[e.jsx("span",{children:"Lanjut ke Review"}),e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"arrow_forward"})]}):e.jsxs("button",{type:"button",disabled:!0,className:"flex w-full cursor-not-allowed items-center justify-center gap-2 rounded-lg bg-gray-300 px-8 py-3 font-bold text-gray-500 md:w-auto",children:[e.jsx("span",{children:"Lanjut ke Review"}),e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"arrow_forward"})]})]})})]})]})}export{J as C};
