import{j as e,L as H,d as _,r as k}from"./app-Ddfl5t9z.js";import{A as G}from"./AdminLayout-DM3a-L7e.js";import"./AdminSidebar-wHxo9R0c.js";function W(t,n){switch(t){case"available":return e.jsx("div",{className:"rounded border border-green-200 bg-green-100 px-2 py-1",children:e.jsxs("p",{className:"truncate text-[10px] font-bold text-green-700",children:[n," Tersedia"]})});case"full":return e.jsx("div",{className:"rounded border border-red-200 bg-red-100 px-2 py-1",children:e.jsx("p",{className:"truncate text-[10px] font-bold text-red-700",children:"Penuh"})});case"off":return e.jsx("div",{className:"rounded border border-yellow-200 bg-yellow-100 px-2 py-1",children:e.jsx("p",{className:"truncate text-[10px] font-bold text-yellow-700",children:"Cuti/Tidak Aktif"})});default:return e.jsx("div",{className:"rounded border border-gray-200 bg-gray-100 px-2 py-1",children:e.jsx("p",{className:"truncate text-[10px] font-bold text-gray-500",children:"Tidak Ada Jadwal"})})}}function V({days:t,onSelectDate:n}){const o=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];return e.jsxs("div",{className:"flex min-h-[600px] flex-1 flex-col overflow-hidden rounded-xl border border-[#e7f0f4] bg-white shadow-sm",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-[#e7f0f4] bg-[#f8fbfc]",children:o.map(s=>e.jsx("div",{className:"py-3 text-center text-xs font-bold uppercase tracking-wider text-[#49829c]",children:s},s))}),e.jsx("div",{className:"grid flex-1 grid-cols-7 grid-rows-5 divide-x divide-y divide-[#e7f0f4]",children:t.map((s,x)=>e.jsxs("div",{onClick:()=>s.isCurrentMonth&&n(s.date),className:`group relative min-h-[100px] p-2 transition-colors ${s.isCurrentMonth?s.isSelected?"z-10 cursor-pointer bg-primary/5 ring-2 ring-inset ring-primary":"cursor-pointer hover:bg-[#f0f7fa]":"bg-[#fcfdfe]"}`,children:[e.jsx("span",{className:`text-sm font-medium ${s.isCurrentMonth?s.isSelected?"flex size-7 items-center justify-center rounded-full bg-primary font-bold text-white shadow-sm":"text-[#0d171c] group-hover:text-primary":"text-[#9abdd0]"}`,children:s.date}),s.isCurrentMonth&&e.jsx("div",{className:"mt-2 flex flex-col gap-1",children:W(s.status,s.availableCount)})]},x))})]})}function q({currentMonth:t,currentYear:n,selectedDoctor:o,doctors:s,onDoctorChange:x,onPrevMonth:i,onNextMonth:m,onToday:l}){return e.jsxs("div",{className:"flex shrink-0 flex-col justify-between gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"mb-2 text-2xl font-bold text-[#0d171c] md:text-3xl",children:[t," ",n]}),e.jsx("p",{className:"text-sm text-[#49829c]",children:"Kelola jadwal dan lihat slot waktu dokter."})]}),e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-3 md:w-auto",children:[e.jsxs("div",{className:"relative min-w-[240px]",children:[e.jsx("select",{value:o?.id||"",onChange:a=>x(a.target.value?Number(a.target.value):null),className:"w-full appearance-none rounded-lg border border-[#cee0e8] bg-white py-2.5 pl-4 pr-10 text-sm font-medium text-[#0d171c] focus:outline-none focus:ring-2 focus:ring-primary/50",children:s.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),e.jsx("span",{className:"material-symbols-outlined pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-[#49829c]",style:{fontSize:"20px"},children:"expand_more"})]}),e.jsxs("div",{className:"flex rounded-lg border border-[#cee0e8] bg-white p-1",children:[e.jsx("button",{onClick:i,className:"rounded-md p-1.5 text-[#0d171c] transition-colors hover:bg-[#f0f7fa]",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"20px"},children:"chevron_left"})}),e.jsx("button",{onClick:l,className:"px-3 py-1.5 text-sm font-bold text-[#0d171c]",children:"Ganti Bulan"}),e.jsx("button",{onClick:m,className:"rounded-md p-1.5 text-[#0d171c] transition-colors hover:bg-[#f0f7fa]",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"20px"},children:"chevron_right"})})]})]})]})}function Q(){return e.jsxs("div",{className:"flex items-center gap-6 px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-sm text-[#0d171c]",children:"Tersedia"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-[#0d171c]",children:"Penuh"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-sm text-[#0d171c]",children:"Cuti / Tidak Aktif"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-gray-300"}),e.jsx("span",{className:"text-sm text-[#0d171c]",children:"Tidak Ada Jadwal"})]})]})}function U(t){const n=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],o=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];return`${n[t.getDay()]}, ${t.getDate()} ${o[t.getMonth()]} ${t.getFullYear()}`}function X(t){const n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${o}-${s}`}function Z({selectedDate:t,totalSlots:n,availableSlots:o,bookedSlots:s,morningSlots:x,afternoonSlots:i,doctorId:m,onClose:l}){if(!t)return null;const a=X(t);return e.jsxs("aside",{className:"z-10 flex w-full shrink-0 flex-col border-l border-[#e7f0f4] bg-white shadow-lg md:w-[360px]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-[#e7f0f4] p-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-[#0d171c]",children:"Detail Jadwal"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"18px"},children:"calendar_today"}),e.jsx("p",{className:"text-sm text-[#49829c]",children:U(t)})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-primary/20 bg-primary/5 p-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide text-primary",children:"Total Slot"}),e.jsx("span",{className:"text-2xl font-bold text-[#0d171c]",children:n})]}),e.jsx("div",{className:"h-8 w-px bg-primary/20"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide text-green-600",children:"Tersedia"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:o})]}),e.jsx("div",{className:"h-8 w-px bg-primary/20"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wide text-red-600",children:"Terisi"}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:s})]})]}),x.length>0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h4",{className:"mb-2 text-sm font-bold uppercase tracking-wider text-[#0d171c]",children:"Slot Pagi"}),x.map((p,h)=>e.jsx(I,{slot:p,doctorId:m,date:a},h))]}),e.jsx("div",{className:"h-px w-full bg-[#e7f0f4]"}),i.length>0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h4",{className:"mb-2 text-sm font-bold uppercase tracking-wider text-[#0d171c]",children:"Slot Siang"}),i.map((p,h)=>e.jsx(I,{slot:p,doctorId:m,date:a},h))]})]})]})}function I({slot:t,doctorId:n,date:o}){const s=()=>{try{sessionStorage.removeItem("bookingData")}catch(i){console.error("Error clearing booking data:",i)}_.visit("/admin/bookings/create")},x=()=>{confirm("Apakah Anda yakin ingin mengunci slot ini?")&&_.post("/admin/doctors/schedule/lock",{doctor_id:n,date:o,start_time:t.time,end_time:t.endTime,note:"Dikunci dari jadwal"},{preserveScroll:!0})};return t.status==="booked"?e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-[#e7f0f4] bg-gray-50 p-3 opacity-90",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-red-500",children:"event_busy"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-[#0d171c]",children:[t.time," - ",t.endTime]}),e.jsx("p",{className:"text-xs font-medium text-slate-700",children:t.patientName||"Terisi"}),t.service&&e.jsx("p",{className:"text-xs italic text-slate-500",children:t.service})]})]}),t.bookingId&&e.jsx(H,{href:`/admin/bookings/${t.bookingId}`,className:"flex size-8 items-center justify-center rounded-full text-primary hover:bg-primary/10",title:"Lihat Booking",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"18px"},children:"visibility"})})]}):t.status==="off"?e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-yellow-200 bg-yellow-50 p-3 opacity-75",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-yellow-600",children:"lock"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-[#0d171c]",children:[t.time," - ",t.endTime]}),e.jsx("p",{className:"text-xs font-medium text-yellow-600",children:"Dikunci"})]})]})}):t.status==="unavailable"?e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-3 opacity-75",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"block"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-[#0d171c]",children:[t.time," - ",t.endTime]}),e.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Tidak Ada Jadwal"})]})]})}):e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-green-600",children:"schedule"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-[#0d171c]",children:[t.time," - ",t.endTime]}),e.jsx("p",{className:"text-xs font-medium text-green-600",children:"Tersedia"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,className:"flex size-8 items-center justify-center rounded-md bg-yellow-500 text-white transition-colors hover:bg-yellow-600",title:"Kunci Slot",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"16px"},children:"lock"})}),e.jsx("button",{onClick:s,className:"rounded-md bg-green-600 px-3 py-1 text-xs font-bold text-white transition-colors hover:bg-green-700",children:"Book"})]})]})}function ee(t){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t]}function te(t){return["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][t]}function se(t,n){return t.some(o=>o.day_of_week===n&&o.is_active)}function ae({doctor:t,availableSlots:n,allDoctors:o}){const[s,x]=k.useState(new Date),[i,m]=k.useState(null),l=s.getFullYear(),a=s.getMonth(),p=k.useMemo(()=>{const d=new Date(l,a,1),j=new Date(l,a+1,0).getDate(),y=d.getDay(),c=new Date,C=c.getFullYear()===l&&c.getMonth()===a,f=[],N=new Date(l,a,0).getDate();for(let r=y-1;r>=0;r--)f.push({date:N-r,isCurrentMonth:!1,isToday:!1,isSelected:!1,status:"no_schedule",availableCount:0,totalSlots:0});for(let r=1;r<=j;r++){const w=`${l}-${String(a+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`,g=n[w],u=new Date(l,a,r),S=te(u.getDay()),E=se(t.working_periods||[],S);let b="no_schedule",M=0,T=0;g?(T=g.slots.length,M=g.slots.filter(F=>F.available).length,T===0?b="no_schedule":M===0?b="full":b="available"):E&&(b=u<new Date(new Date().setHours(0,0,0,0))?"no_schedule":"off"),f.push({date:r,isCurrentMonth:!0,isToday:C&&c.getDate()===r,isSelected:i===r,status:b,availableCount:M,totalSlots:T})}const v=42-f.length;for(let r=1;r<=v;r++)f.push({date:r,isCurrentMonth:!1,isToday:!1,isSelected:!1,status:"no_schedule",availableCount:0,totalSlots:0});return f},[l,a,i,n,t.working_periods]),h=k.useMemo(()=>{if(!i)return{morning:[],afternoon:[]};const d=`${l}-${String(a+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,D=n[d];if(!D)return{morning:[],afternoon:[]};const j=[],y=[];for(const c of D.slots){const[C,f]=c.time.split(":"),N=parseInt(C,10),v=parseInt(f,10),r=new Date;r.setHours(N,v,0,0);const w=new Date(r);w.setMinutes(v+(c.slot_type==="long"?45:15));const g=w.toTimeString().slice(0,5);let u="unavailable";c.available?u="available":c.reason==="time_off"?u="off":c.reason==="booked"?u="booked":u="unavailable";const S={time:c.time,endTime:g,status:u,patientName:c.patient_name,service:c.service,bookingId:c.booking_id};N<12?j.push(S):y.push(S)}return{morning:j,afternoon:y}},[i,l,a,n]),L=()=>{x(new Date(l,a-1,1)),m(null)},P=()=>{x(new Date(l,a+1,1)),m(null)},O=()=>{const d=new Date;x(d),m(d.getDate())},B=d=>{d&&_.get(`/admin/schedule/${d}`,{},{preserveState:!1})},K=d=>{m(d)},Y=i?new Date(l,a,i):null,$=i?`${l}-${String(a+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`:null,z=$?n[$]:null,A=z?.slots.length||0,J=z?.slots.filter(d=>d.available).length||0,R=A-J;return e.jsxs("div",{className:"flex h-full flex-col gap-6 bg-[#f8fbfc] md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-6 overflow-y-auto p-6",children:[e.jsx(q,{currentMonth:ee(a),currentYear:l,selectedDoctor:t,doctors:o,onDoctorChange:B,onPrevMonth:L,onNextMonth:P,onToday:O}),e.jsx(V,{days:p,onSelectDate:K}),e.jsx(Q,{})]}),i&&e.jsx(Z,{selectedDate:Y,totalSlots:A,availableSlots:J,bookedSlots:R,morningSlots:h.morning,afternoonSlots:h.afternoon,doctorId:t.id,onClose:()=>m(null)})]})}ae.layout=t=>e.jsx(G,{children:t});export{ae as default};
